import { IIgnoreService } from '../../../../../../../platform/ignore/common/ignoreService';
import { IInstantiationService, ServicesAccessor } from '../../../../../../../util/vs/platform/instantiation/common/instantiation';
import { CancellationToken as ICancellationToken } from '../../../../types/src';
import { ICompletionsFileSystemService } from '../../fileSystem';
import { LRUCacheMap } from '../../helpers/cache';
import { ICompletionsLogTargetService, Logger } from '../../logger';
import { TelemetryWithExp } from '../../telemetry';
import { NeighboringFileType } from './neighborFiles';
export interface RelatedFilesDocumentInfo {
    readonly uri: string;
    readonly clientLanguageId: string;
    data?: unknown;
}
interface RelatedFilesTextDocument {
    readonly uri: string;
    readonly clientLanguageId: string;
    readonly detectedLanguageId: string;
}
export type RelatedFilesResponseEntry = {
    type: NeighboringFileType;
    uris: string[];
};
export type RelatedFileTrait = {
    name: string;
    value: string;
    includeInPrompt?: boolean;
    promptTextOverride?: string;
};
export type RelatedFilesResponse = {
    entries: RelatedFilesResponseEntry[];
    traits?: RelatedFileTrait[];
};
type RelatedFiles = {
    entries: RelatedFilesType;
    traits: RelatedFileTrait[];
};
export type RelatedFilesType = Map<NeighboringFileType, Map<string, string>>;
export declare const EmptyRelatedFilesResponse: RelatedFilesResponse;
type TimestampEntry = {
    timestamp: number;
    retryCount: number;
};
export declare class PromiseExpirationCacheMap<T> extends LRUCacheMap<string, Promise<T>> {
    private readonly defaultEvictionTimeMs;
    _cacheTimestamps: Map<string, TimestampEntry>;
    constructor(size: number, defaultEvictionTimeMs?: number);
    bumpRetryCount(key: string): number;
    has(key: string): boolean;
    get(key: string): Promise<T> | undefined;
    set(key: string, value: Promise<T>): this;
    clear(): void;
    private isValid;
    private deleteExpiredEntry;
}
export declare const relatedFilesLogger: Logger;
export declare const ICompletionsRelatedFilesProviderService: import("../../../../../../../util/common/services").ServiceIdentifier<ICompletionsRelatedFilesProviderService>;
export interface ICompletionsRelatedFilesProviderService {
    readonly _serviceBrand: undefined;
    getRelatedFilesResponse(docInfo: RelatedFilesDocumentInfo, telemetryData: TelemetryWithExp, cancellationToken: ICancellationToken | undefined): Promise<RelatedFilesResponse | undefined>;
    getRelatedFiles(docInfo: RelatedFilesDocumentInfo, telemetryData: TelemetryWithExp, cancellationToken: ICancellationToken | undefined): Promise<RelatedFiles | undefined>;
}
/**
 * Class for getting the related files to the current active file (implemented in the extension or the agent).
 */
export declare abstract class RelatedFilesProvider implements ICompletionsRelatedFilesProviderService {
    protected readonly instantiationService: IInstantiationService;
    protected readonly ignoreService: IIgnoreService;
    protected readonly logTarget: ICompletionsLogTargetService;
    protected readonly fileSystemService: ICompletionsFileSystemService;
    _serviceBrand: undefined;
    constructor(instantiationService: IInstantiationService, ignoreService: IIgnoreService, logTarget: ICompletionsLogTargetService, fileSystemService: ICompletionsFileSystemService);
    abstract getRelatedFilesResponse(docInfo: RelatedFilesDocumentInfo, telemetryData: TelemetryWithExp, cancellationToken: ICancellationToken | undefined): Promise<RelatedFilesResponse | undefined>;
    getRelatedFiles(docInfo: RelatedFilesDocumentInfo, telemetryData: TelemetryWithExp, cancellationToken: ICancellationToken | undefined): Promise<RelatedFiles | undefined>;
    protected getFileContent(uri: string): Promise<string | undefined>;
    private isContentExcluded;
    private static dropBOM;
}
/**
 * For a given document, it provides a list of related files and traits
 * @param ctx The context.
 * @param doc The document information.
 * @param telemetryData Object used to send telemetry and check experimentation options.
 * @param cancellationToken The cancellation token.
 * @param data Additional arbitrary data to be passed to the provider.
 * @param forceComputation Set true to force computation by skipping cache and timeout.
 * @returns Related files and traits.
 */
export declare function getRelatedFilesAndTraits(accessor: ServicesAccessor, doc: RelatedFilesTextDocument, telemetryData: TelemetryWithExp, cancellationToken?: ICancellationToken, data?: unknown, forceComputation?: boolean): Promise<RelatedFiles>;
export {};
//# sourceMappingURL=relatedFiles.d.ts.map